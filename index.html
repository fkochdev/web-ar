<!DOCTYPE html>
<html>
  <head>
    <title>WebAR Marker</title>
    <meta name="WebAR Marker Samples" content="WebAR Sample">
    <link id="favicon" rel="icon" href="https://glitch.com/edit/favicon-app.ico" type="image/x-icon">
    <meta charset="utf-8">
    <!--meta http-equiv="X-UA-Compatible" content="IE=edge"-->
    <!--meta name="viewport" content="width=device-width, initial-scale=1"-->
    <meta name="apple-mobile-web-app-capable" content="yes">
<script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
<script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>


    <style type="text/css">

		p {
		  font-family: Arial, Helvetica, sans-serif;
		}

      #splash {
        display: flex;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;

        align-items: center;
        justify-content: center;
        
        background: rgba(0, 0, 0, 1);
        color: white;
        cursor: pointer;
        z-index: 999;
        font-size: 2vw;
      }

      #camhint {
        display: flex;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;

        align-items: center;
        justify-content: center;
        
        background: rgba(0, 0, 0, 1);
        color: white;
        cursor: pointer;
        z-index: -2;
        font-size: 2vw;
      }

      #impressum {
        display: flex;
        position: fixed;
        top: 90%;
        left: 0;
        right: 0;
        bottom: 0;

        align-items: center;
        justify-content: center;
        
        background: rgba(0, 0, 0, 1);
        color: white;
        cursor: pointer;
        z-index: 999;
        font-size: 1vw;
      }
    </style>
    <script>
		AFRAME.registerComponent('vidhandler', {
         init: function () {
          this.toggle = false;
          document.querySelector("#video").pause(); //reference to the video
         },
         tick:function(){  
         if(document.querySelector("a-marker").object3D.visible == true){
           if(!this.toggle){
             this.toggle = true;
             document.querySelector("#video").play();
           }
         }else{
           this.toggle = false;
           document.querySelector("#video").pause();
         }
         }
         });

      document.addEventListener("DOMContentLoaded", function(event) {
        var scene = document.querySelector("a-scene");
        var vid = document.getElementById("video");

		document.querySelector('#splash').style.display = 'flex';
        document.querySelector('#splash').addEventListener('click', function () {
	        vid.play();
        	this.style.display = 'none';
        })
      })
    </script>

  </head>
  <body>

<div id="camhint">
      <div id="start-button">
      	<p align="center">Please allow camera access.</p>
      	<p align="center">Bitte Kamera-Zugriff erlauben.</p>

      </div>
    </div>

 <div id="splash">
      <div id="start-button">
      	<p align="center">[ Start WebAR ]</p>

      </div>
    </div>

     <div id="impressum">
      	<p align="center">(c) 2020, Florian Koch <a href="mailto:fkoch.dev@gmail.com">(E-Mail)</a></p>
    </div>

    <a-scene 
    vr-mode-ui="enabled: false;"
    device-orientation-permission-ui="enabled: false;"
    renderer="antialias: true; logarithmicDepthBuffer: true; colorManagement: true;"
    embedded
    arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;"
    light="defaultLightsEnabled: false;"
    >

    /* MARKER BASED */
    	<a-assets>
        	<video webkit-playsinline playsinline crossorigin="anonymous" type="video/mp4" id="video" loop="true" src="models/video.mp4"></video>
        </a-assets>

        <!--a-light color="white" position="-15 15 -15" distance="200" intensity="1"></a-light-->
		<a-entity light="type: ambient; color: #ffffe0; intensity: 1;"></a-entity>
       <a-entity light="type: directional; color: #ffffe0; target: lightTarget; position: 15 15 15; distance: 200; intensity: 2;"></a-entity>

       <!--a-marker preset="custom" type="pattern" url="marker/marker0.patt">  
	       <a-entity gltf-model="models/elephant.glb" position="0 0 0" scale="1 1 1"></a-entity>     
	   </a-marker-->	

	   <a-marker preset="custom" type="pattern" url="marker/marker_kolatest.patt">  
	       <a-video src="#video" width="2.56" height="1.44" position="0 0 0" rotation="-90 0 0" vidhandler></a-video>
	   </a-marker>	
      
       <a-marker preset="custom" type="pattern" url="marker/marker1.patt">
            <a-entity animation="property: rotation; from: 0 0 0; to: 0 360 0; loop: true; dur: 10000">
	            <a-entity gltf-model="models/car.glb" id="lightTarget" position="-1.7 0 -2.5" rotation="0 90 0" scale="0.4 0.4 0.4"></a-entity>	
	            <a-entity gltf-model="models/House.gltf" position="0 0 0" scale="0.004 0.004 0.004"></a-entity>
            </a-entity>     

        </a-marker>
      
        <a-marker preset="custom" type="pattern" url="marker/marker_fk.patt">
	        <a-entity animation="property: rotation; from: 0 0 0; to: 0 360 0; loop: true; dur: 10000">
	            <a-entity gltf-model="models/car.glb" id="lightTarget" position="0 0 0" rotation="0 90 0" scale="0.4 0.4 0.4"></a-entity>	
            </a-entity>
        </a-marker>

    /* NFT BASED */

     <a-nft
        type="nft"
        url="marker/cds"
        smooth="true"
        smoothCount="10"
        smoothTolerance=".01"
        smoothThreshold="5">
          <!-- as a child of the a-nft entity, you can define the content to show. here's a GLTF model entity -->
          
            <a-entity
          gltf-model="models/House.gltf"
              scale="0.05 0.05 0.05"
              position="50 5 -50"
              rotation="45 -270 -90"
              animation="property: rotation; from: 45 -270 -90; to: 405 -270 -90; loop: true; dur: 10000"
          >
          </a-entity>
      </a-nft>

      <a-entity camera></a-entity>
      <!--a-camera-static/-->
    </a-scene>

    <!--script>
window.addEventListener('click', function () {
  var v = document.querySelector('#video
});
</script-->

  </body>
</html>